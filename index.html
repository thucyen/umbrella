<!DOCTYPE html>
<html lang="en">=

<head>
    <meta charset="utf-8">
    <title>Game: Under My Umbrella</title>
</head>

<body>
    <canvas id="canvas1"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/processing.js/1.6.6/processing.min.js"> </script>
    <script type="text/javascript">
        /* Game: Under My Umbrella
        It's rainy outside but it's also full of love. 
        Your tool is a magic umbrella. Your task is to catch all hearts and to protect the team under your umbrella. If you break more than 20 hearts, they will be heart-broken. If they catch too much rain, they will get a cold. 
        Move the umbrella with your mouse! Good luck!
        */
        var umbrella = function (processing) {
            var toggle = false;
            var f = processing.loadFont("animeace.ttf");
            processing.textFont(f);
            // rain position
            var xPositions = [200];
            var yPositions = [0];
            var defColor = [processing.color(255, 0, 0)];
            var speed = [5];
            // heart position
            var heartX = [30];
            var heartY = [20];
            var heartBroken = 0;
            var getCold = 0;
            var time = 0;
            var fancyText = function () {
                processing.fill(72, 93, 156);
                f = processing.loadFont("type-font.ttf");
                processing.textFont(f);
            };
            var normalText = function () {
                f = processing.loadFont("animeace.ttf");
                processing.textFont(f);
                processing.fill(237, 35, 193);
            };


            // draw rain
            for (var numberdrop = 0; numberdrop < 100; numberdrop++) {
                xPositions.push(20 * processing.random(0, 20));
                yPositions.push(0 + 20 * processing.random(0, 20));
                defColor.push(processing.color(processing.random(0, 225), processing.random(0, 225), processing.random(0, 225)));
                speed.push(processing.random(5, 7));
            }
            // define heart
            var heartnum = 0;
            var decideHeart = function () {
                while (heartnum < 5) {
                    heartX.push(50 * floor(processing.random(0, 8)));
                    heartY.push(50 + 60 * floor(processing.random(60, 100)));
                    heartnum++;
                }
            };
            decideHeart();

            var outsideUmbrella = function (x, umbrellaX) {
                return (x < umbrellaX || x > umbrellaX + 240);
            };

            provessing.draw = function () {
                if (!toggle) {
                    return;
                }
                // Check if game is over
                if (heartBroken >= 50 && floor(getCold / 300) > 100) {
                    normalText();
                    processing.fill(191, 88, 88);
                    rect(20, 0, 360, 400);
                    processing.image(loadImage("/sad.png"), 129, 127);
                    processing.fill(255, 250, 250);
                    processing.textSize(35);
                    processing.text("GAME OVER", 200, 310);
                    processing.text("Your score: " + floor(time / 1000), 200, 350);
                    processing.textSize(12);
                }

                else {
                    processing.background(217, 255, 0);
                    processing.noStroke();

                    // RAIN DROP
                    for (var i = 0; i < xPositions.length; i++) {
                        processing.fill(defColor[i]);
                        processing.ellipse(xPositions[i], yPositions[i], 3, 6);
                        yPositions[i] = yPositions[i] + speed[i];
                        time++;
                        // rain back
                        if (outsideUmbrella(xPositions[i], mouseX)) {
                            //this is the notification that the umbrella is not covering the team from Rain
                            if (xPositions[i] > 110 && yPositions[i] > 255 && xPositions[i] < 360 & yPositions[i] < 375) {
                                fancyText();
                                processing.textSize(12);
                                processing.text("We're cold", 200, 240);
                            }
                            // losing Cold point
                            if (xPositions[i] > 110 && xPositions[i] < 360) {
                                getCold++;
                            }
                            // if rain reach the end of the canvas, return to 0
                            if (yPositions[i] > 400) {
                                yPositions[i] = 0;
                            }
                        }
                        //Umbrella effect. If rains meet umbrella, rain goes back to the top of the canvas
                        if (!outsideUmbrella(xPositions[i], mouseX)) {
                            if (yPositions[i] > mouseY) {
                                yPositions[i] = 0;
                            }
                        }

                    }

                    // Part 2: HEART DROP

                    for (var j = 0; j < heartX.length; j++) {
                        processing.image(loadImage("/heart.png"), heartX[j], heartY[j], 15, 15);
                        heartY[j] += 5 + j * 0.5;
                        if (outsideUmbrella(heartX[j], mouseX)) {
                            // If a heart reaches the bottom, heart goes back to the top, the user loses Heart point.
                            if (heartY[j] > 400) {
                                heartBroken++;
                                heartY[j] = 0;
                            }
                        }
                        if (!outsideUmbrella(heartX[j], mouseX)) {
                            if (heartY[j] > mouseY) {
                                heartY[j] = 0;
                            }
                        }
                    }
                    // Other elements
                    processing.image(loadImage("/Team.png"), 116, 255, 240, 120);
                    processing.fill(232, 79, 79);
                    //umbrella moves with the mouse
                    processing.rect(mouseX, mouseY, 240, 30);
                    normalText();
                    processing.textSize(14);
                    processing.fill(255, 255, 255);
                    processing.text("This is an umbrella", mouseX + 120, mouseY + 13);
                    // Scoreboard
                    processing.fill(237, 35, 193);
                    processing.textSize(15);
                    processing.textAlign(LEFT, TOP);
                    normalText();
                    processing.text("Broken Hearts: " + heartBroken + "/50", 30, 30);
                    processing.text("Cold: " + floor(getCold / 300) + "%", 30, 50);
                    processing.text("Score: " + floor(time / 1000), 300, 30);
                    // Other text
                    processing.textAlign(CENTER, CENTER);
                    // Warning when a condition is met.
                    normalText();
                    processing.textSize(18);
                    if (heartBroken >= 50) {
                        processing.text("Oh!!!! You broke our hearts.", 200, 180);
                    }
                    if (processing.floor(getCold / 300) > 100) {
                        processing.text("Oouch, we've got a cold!", 200, 205);
                    }
                }
            };

            // Instruction
            processing.background(217, 255, 0);
            processing.textAlign(CENTER, CENTER);
            // Game name
            normalText();
            processing.textSize(42);
            processing.text("Under my Umbrella", 200, 80);
            // the team
            processing.image(loadImage("/Team.png"), 102, 140);
            // Game rule
            processing.textSize(14);
            fancyText();
            processing.text("Try to catch as many heart as you can, \n but at the same time make sure \nyour team stay under your umbrella", 200, 300);
            //Instruction 3
            f = processing.loadFont("animeace.ttf");
            normalText();
            processing.textSize(16);
            processing.text("Press Enter to start/pause the game", 200, 350);

            // Execute game by Pressing Enter
            processing.keyPressed = function () {
                if (keyCode === 10) {
                    toggle = !toggle;
                }
            };
        };
        var canvas = document.getElementById("canvas1");
        var processingInstance = new Processing(canvas, umbrella);
    </script>
</body>

</html>
